"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[5772],{80223:(J,O,s)=>{s.d(O,{F:()=>D});var e=s(53657),t=s(96125),u=s(2669),o=s(99283),m=s(29776),l=s(33211),i=s(59013),P=s(82154);const D=({displayedFilters:n})=>{const[_,g]=(0,t.useState)(!1),{formatMessage:E}=(0,P.Z)(),d=(0,t.useRef)(),M=()=>{g(K=>!K)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(u.x,{paddingTop:1,paddingBottom:1,children:[(0,e.jsx)(o.z,{variant:"tertiary",ref:d,startIcon:(0,e.jsx)(l.Z,{}),onClick:M,size:"S",children:E({id:"app.utils.filters",defaultMessage:"Filters"})}),_&&(0,e.jsx)(m.FilterPopoverURLQuery,{displayedFilters:n,isVisible:_,onToggle:M,source:d})]}),(0,e.jsx)(m.FilterListURLQuery,{filtersSchema:n})]})};D.propTypes={displayedFilters:i.arrayOf(i.shape({name:i.string.isRequired,metadatas:i.shape({label:i.string}),fieldSchema:i.shape({type:i.string})})).isRequired}},5772:(J,O,s)=>{s.r(O),s.d(O,{U:()=>he,i:()=>Re});var e=s(53657),t=s(29776),u=s(2108),o=s(67810),m=s(96125),l=s(99283),i=s(18946),P=s(41427),D=s(35960),n=s(91019),_=s(48814),g=s(93134),E=s(9991),d=s(2669),M=s(83416),K=s(68577),oe=s(17855),ae=s(50810),S=s(91845),L=s(77461),y=s(7139),b=s(55613),X=s(36956),k=s(6620),w=s(50973),x=s(82154),N=s(80107),ne=s(33541),le=s(69567),F=s(75377),de=s(80223),v=s(39712),fe=s(60773),Pe=s(63922),c=s(59013),De=s(99216),Oe=s(41062),ye=s(18239),_e=s(60515),q=s(59891);const ge=({onClick:a})=>{const{formatMessage:p}=(0,x.Z)();return(0,e.jsx)(l.z,{onClick:a,startIcon:(0,e.jsx)(v.Z,{}),size:"S",children:p({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"})})};ge.propTypes={onClick:c.func.isRequired};const ce=({canDelete:a,headers:p,entriesToDelete:T,onClickDelete:ee,onSelectRow:$,withMainAction:Z,withBulkActions:B,rows:R})=>{const{push:C,location:{pathname:Q}}=(0,ne.k6)(),{formatMessage:A}=(0,x.Z)();return(0,e.jsx)(i.p,{children:R.map(r=>{const z=T.findIndex(U=>U===r.id)!==-1;return(0,e.jsxs)(P.Tr,{...(0,t.onRowClick)({fn:()=>C(`${Q}/${r.id}`),condition:B}),children:[Z&&(0,e.jsx)(D.Td,{...t.stopPropagation,children:(0,e.jsx)(n.C,{"aria-label":A({id:"app.component.table.select.one-entry",defaultMessage:"Select {target}"},{target:(0,o.g)(r.firstname,r.lastname)}),checked:z,onChange:()=>{$({name:r.id,value:!z})}})}),p.map(({key:U,cellFormatter:V,name:W,...Y})=>(0,e.jsx)(D.Td,{children:typeof V=="function"?V(r,{key:U,name:W,formatMessage:A,...Y}):(0,e.jsx)(_.Z,{textColor:"neutral800",children:r[W]||"-"})},U)),B&&(0,e.jsx)(D.Td,{children:(0,e.jsxs)(g.k,{justifyContent:"end",children:[(0,e.jsx)(E.h,{onClick:()=>C(`${Q}/${r.id}`),label:A({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:(0,o.g)(r.firstname,r.lastname)}),noBorder:!0,icon:(0,e.jsx)(fe.Z,{})}),a&&(0,e.jsx)(d.x,{paddingLeft:1,...t.stopPropagation,children:(0,e.jsx)(E.h,{onClick:()=>ee(r.id),label:A({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:(0,o.g)(r.firstname,r.lastname)}),noBorder:!0,icon:(0,e.jsx)(Pe.Z,{})})})]})})]},r.id)})})};ce.defaultProps={canDelete:!1,entriesToDelete:[],onClickDelete(){},onSelectRow(){},rows:[],withBulkActions:!1,withMainAction:!1},ce.propTypes={canDelete:c.bool,entriesToDelete:c.array,headers:c.array.isRequired,onClickDelete:c.func,onSelectRow:c.func,rows:c.array,withBulkActions:c.bool,withMainAction:c.bool};const Ee={firstname:"",lastname:"",email:"",roles:[]},xe=[],Ce=[[{intlLabel:{id:"Auth.form.firstname.label",defaultMessage:"First name"},name:"firstname",placeholder:{id:"Auth.form.firstname.placeholder",defaultMessage:"e.g. Kai"},type:"text",size:{col:6,xs:12},required:!0},{intlLabel:{id:"Auth.form.lastname.label",defaultMessage:"Last name"},name:"lastname",placeholder:{id:"Auth.form.lastname.placeholder",defaultMessage:"e.g. Doe"},type:"text",size:{col:6,xs:12}}],[{intlLabel:{id:"Auth.form.email.label",defaultMessage:"Email"},name:"email",placeholder:{id:"Auth.form.email.placeholder",defaultMessage:"e.g. kai.doe@strapi.io"},type:"email",size:{col:6,xs:12},required:!0}]],Ae=q.Ry().shape({firstname:q.Z_().trim().required(t.translatedErrors.required),lastname:q.Z_(),email:q.Z_().email(t.translatedErrors.email).required(t.translatedErrors.required),roles:q.IX().min(1,t.translatedErrors.required).required(t.translatedErrors.required)}),ve={create:{buttonSubmitLabel:{id:"app.containers.Users.ModalForm.footer.button-success",defaultMessage:"Invite user"},isDisabled:!1,next:"magic-link"},"magic-link":{buttonSubmitLabel:{id:"global.finish",defaultMessage:"Finish"},isDisabled:!0,next:null}},Me=({onSuccess:a,onToggle:p})=>{const[T,ee]=(0,m.useState)("create"),[$,Z]=(0,m.useState)(!1),[B,R]=(0,m.useState)(null),{formatMessage:C}=(0,x.Z)(),Q=(0,t.useNotification)(),{lockApp:A,unlockApp:r}=(0,t.useOverlayBlocker)(),{post:z}=(0,t.useFetchClient)(),U=(0,F.p)(xe,async()=>(await s.e(1766).then(s.bind(s,31766))).ROLE_LAYOUT,{combine(f,I){return[...f,I]},defaultValue:[]}),V=(0,F.p)(Ee,async()=>(await s.e(1766).then(s.bind(s,31766))).FORM_INITIAL_VALUES,{combine(f,I){return{...f,...I}},defaultValue:Ee}),W=(0,F.p)(_e.M,async()=>(await s.e(5861).then(s.bind(s,75861))).MagicLinkEE),Y=(0,N.useMutation)(f=>z("/admin/users",f),{async onSuccess({data:f}){R(f.data.registrationToken),await a(),re(),Z(!1)},onError(f){throw Z(!1),Q({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),f},onSettled(){r()}}),se=C({id:"Settings.permissions.users.create",defaultMessage:"Invite new user"}),ie=async(f,{setErrors:I})=>{A(),Z(!0);try{await Y.mutateAsync(f)}catch(G){r(),G?.response?.data?.error.message==="Email already taken"&&I({email:G.response.data.error.message})}},re=()=>{h?ee(h):p()},{buttonSubmitLabel:te,isDisabled:H,next:h}=ve[T],Ue=T==="create"?(0,e.jsx)(l.z,{type:"submit",loading:$,children:C(te)}):(0,e.jsx)(l.z,{type:"button",loading:$,onClick:p,children:C(te)});return W?(0,e.jsxs)(M.P,{onClose:p,labelledBy:"title",children:[(0,e.jsx)(K.x,{children:(0,e.jsx)(De.O,{label:se,children:(0,e.jsx)(Oe.$,{isCurrent:!0,children:se})})}),(0,e.jsx)(ye.J9,{enableReinitialize:!0,initialValues:V,onSubmit:ie,validationSchema:Ae,validateOnChange:!1,children:({errors:f,handleChange:I,values:G})=>(0,e.jsxs)(t.Form,{children:[(0,e.jsx)(oe.f,{children:(0,e.jsxs)(g.k,{direction:"column",alignItems:"stretch",gap:6,children:[T!=="create"&&(0,e.jsx)(W,{registrationToken:B}),(0,e.jsxs)(d.x,{children:[(0,e.jsx)(_.Z,{variant:"beta",as:"h2",children:C({id:"app.components.Users.ModalCreateBody.block-title.details",defaultMessage:"User details"})}),(0,e.jsx)(d.x,{paddingTop:4,children:(0,e.jsx)(g.k,{direction:"column",alignItems:"stretch",gap:1,children:(0,e.jsx)(ae.r,{gap:5,children:Ce.map(ue=>ue.map(j=>(0,e.jsx)(S.P,{...j.size,children:(0,e.jsx)(t.GenericInput,{...j,disabled:H,error:f[j.name],onChange:I,value:G[j.name]})},j.name)))})})})]}),(0,e.jsxs)(d.x,{children:[(0,e.jsx)(_.Z,{variant:"beta",as:"h2",children:C({id:"global.roles",defaultMessage:"User's role"})}),(0,e.jsx)(d.x,{paddingTop:4,children:(0,e.jsxs)(ae.r,{gap:5,children:[(0,e.jsx)(S.P,{col:6,xs:12,children:(0,e.jsx)(_e.S,{disabled:H,error:f.roles,onChange:I,value:G.roles})}),U.map(ue=>ue.map(j=>(0,e.jsx)(S.P,{...j.size,children:(0,e.jsx)(t.GenericInput,{...j,disabled:H,onChange:I,value:G[j.name]})},j.name)))]})})]})]})}),(0,e.jsx)(L.m,{startActions:(0,e.jsx)(l.z,{variant:"tertiary",onClick:p,type:"button",children:C({id:"app.components.Button.cancel",defaultMessage:"Cancel"})}),endActions:Ue})]})})]}):null};Me.propTypes={onToggle:c.func.isRequired,onSuccess:c.func.isRequired};const me=({pagination:a})=>(0,e.jsx)(d.x,{paddingTop:4,children:(0,e.jsxs)(g.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(t.PageSizeURLQuery,{}),(0,e.jsx)(t.PaginationURLQuery,{pagination:a})]})});me.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},me.propTypes={pagination:c.shape({page:c.number,pageCount:c.number,pageSize:c.number,total:c.number})};const Te=[{name:"firstname",metadatas:{label:"Firstname"},fieldSchema:{type:"string"}},{name:"lastname",metadatas:{label:"Lastname"},fieldSchema:{type:"string"}},{name:"email",metadatas:{label:"Email"},fieldSchema:{type:"email"}},{name:"username",metadatas:{label:"Username"},fieldSchema:{type:"string"}},{name:"isActive",metadatas:{label:"Active user"},fieldSchema:{type:"boolean"}}],je=[{name:"firstname",key:"firstname",metadatas:{label:{id:"Settings.permissions.users.firstname",defaultMessage:"Firstname"},sortable:!0}},{name:"lastname",key:"lastname",metadatas:{label:{id:"Settings.permissions.users.lastname",defaultMessage:"Lastname"},sortable:!0}},{key:"email",name:"email",metadatas:{label:{id:"Settings.permissions.users.email",defaultMessage:"Email"},sortable:!0}},{key:"roles",name:"roles",metadatas:{label:{id:"Settings.permissions.users.roles",defaultMessage:"Roles"},sortable:!1},cellFormatter({roles:a},{formatMessage:p}){return(0,e.jsx)(_.Z,{textColor:"neutral800",children:a.map(T=>p({id:`Settings.permissions.users.${T.code}`,defaultMessage:T.name})).join(`,
`)})}},{key:"username",name:"username",metadatas:{label:{id:"Settings.permissions.users.username",defaultMessage:"Username"},sortable:!0}},{key:"isActive",name:"isActive",metadatas:{label:{id:"Settings.permissions.users.user-status",defaultMessage:"User status"},sortable:!1},cellFormatter({isActive:a},{formatMessage:p}){return(0,e.jsxs)(g.k,{children:[(0,e.jsx)(t.Status,{isActive:a,variant:a?"success":"danger"}),(0,e.jsx)(_.Z,{textColor:"neutral800",children:p({id:a?"Settings.permissions.users.active":"Settings.permissions.users.inactive",defaultMessage:a?"Active":"Inactive"})})]})}}],pe=["ee","license-limit-info"],he=()=>{const{post:a}=(0,t.useFetchClient)(),{formatAPIError:p}=(0,t.useAPIErrorHandler)(),[T,ee]=(0,m.useState)(!1),$=(0,u.v9)(o.s),{allowedActions:{canCreate:Z,canDelete:B,canRead:R}}=(0,t.useRBAC)($.settings.users),C=(0,N.useQueryClient)(),Q=(0,t.useNotification)(),{formatMessage:A}=(0,x.Z)(),{search:r}=(0,ne.TH)();(0,t.useFocusWhenNavigate)();const{users:z,pagination:U,isError:V,isLoading:W,refetch:Y}=(0,le.u)(w.parse(r,{ignoreQueryPrefix:!0}),{cacheTime:0,enabled:R}),se=(0,F.p)(ge,async()=>(await s.e(7477).then(s.bind(s,97477))).CreateActionEE),ie=je.map(h=>({...h,metadatas:{...h.metadatas,label:A(h.metadatas.label)}})),re=A({id:"global.users",defaultMessage:"Users"}),te=()=>{ee(h=>!h)},H=(0,N.useMutation)(async h=>{await a("/admin/users/batch-delete",{ids:h})},{async onSuccess(){await Y(),await C.refetchQueries(pe)},onError(h){Q({type:"warning",message:{id:"notification.error",message:p(h),defaultMessage:"An error occured"}})}});return se?(0,e.jsxs)(y.o,{"aria-busy":W,children:[(0,e.jsx)(t.SettingsPageTitle,{name:"Users"}),(0,e.jsx)(b.T,{primaryAction:Z&&(0,e.jsx)(se,{onClick:te}),title:re,subtitle:A({id:"Settings.permissions.users.listview.header.subtitle",defaultMessage:"All the users who have access to the Strapi admin panel"})}),R&&(0,e.jsx)(X.Z,{startActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.SearchURLQuery,{label:A({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:re})}),(0,e.jsx)(de.F,{displayedFilters:Te})]})}),(0,e.jsxs)(k.D,{canRead:R,children:[!R&&(0,e.jsx)(t.NoPermissions,{}),V&&(0,e.jsx)("div",{children:"TODO: An error occurred"}),R&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(t.DynamicTable,{contentType:"Users",isLoading:W,onConfirmDeleteAll:H.mutateAsync,onConfirmDelete:h=>H.mutateAsync([h]),headers:ie,rows:z,withBulkActions:!0,withMainAction:B,children:(0,e.jsx)(ce,{canDelete:B,headers:ie,rows:z,withBulkActions:!0,withMainAction:B})}),U&&(0,e.jsx)(me,{pagination:U})]})]}),T&&(0,e.jsx)(Me,{onSuccess:async()=>{await Y(),await C.refetchQueries(pe)},onToggle:te})]}):null},Le=()=>{const a=(0,F.p)(he,async()=>(await s.e(2320).then(s.bind(s,42320))).UserListPageEE);return a?(0,e.jsx)(a,{}):null},Re=Object.freeze(Object.defineProperty({__proto__:null,default:()=>{const a=(0,u.v9)(o.s);return(0,e.jsx)(t.CheckPagePermissions,{permissions:a.settings.users.main,children:(0,e.jsx)(Le,{})})}},Symbol.toStringTag,{value:"Module"}))},60515:(J,O,s)=>{s.d(O,{M:()=>d,S:()=>S,a:()=>E});var e=s(53657),t=s(59013),u=s(82154),o=s(75377),m=s(9991),l=s(37367),i=s(45486),P=s(29776),D=s(23865),n=s(51313),_=s(80107),g=s(87426);const E=({children:L,target:y})=>{const b=(0,P.useNotification)(),{formatMessage:X}=(0,u.Z)(),{copy:k}=(0,P.useClipboard)(),w=X({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),x=async()=>{await k(y)&&b({type:"info",message:{id:"notification.link-copied"}})};return(0,e.jsx)(P.ContentBox,{endAction:(0,e.jsx)(m.h,{label:w,noBorder:!0,icon:(0,e.jsx)(D.Z,{}),onClick:x}),title:y,titleEllipsis:!0,subtitle:L,icon:(0,e.jsx)("span",{style:{fontSize:32},children:"\u2709\uFE0F"}),iconBackground:"neutral100"})};E.propTypes={children:t.oneOfType([t.element,t.string]).isRequired,target:t.string.isRequired};const d=({registrationToken:L})=>{const{formatMessage:y}=(0,u.Z)(),b=`${window.location.origin}${(0,o.T)()}/auth/register?registrationToken=${L}`;return(0,e.jsx)(E,{target:b,children:y({id:"app.components.Users.MagicLink.connect",defaultMessage:"Copy and share this link to give access to this user"})})};d.defaultProps={registrationToken:""},d.propTypes={registrationToken:t.string};const M=(0,g.keyframes)`
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(359deg);
  }
`,K=g.default.div`
  animation: ${M} 2s infinite linear;
`,oe=()=>(0,e.jsx)(K,{children:(0,e.jsx)(n.Z,{})}),ae=async()=>{const{get:L}=(0,P.getFetchClient)(),{data:y}=await L("/admin/roles");return y.data},S=({disabled:L,error:y,onChange:b,value:X})=>{const{status:k,data:w}=(0,_.useQuery)(["roles"],ae,{staleTime:5e4}),{formatMessage:x}=(0,u.Z)(),N=y?x({id:y,defaultMessage:y}):"",ne=x({id:"app.components.Users.ModalCreateBody.block-title.roles",defaultMessage:"User's roles"}),le=x({id:"app.components.Users.ModalCreateBody.block-title.roles.description",defaultMessage:"A user can have one or several roles"}),F=x({id:"app.components.Select.placeholder",defaultMessage:"Select"}),de=k==="loading"?(0,e.jsx)(oe,{}):void 0;return(0,e.jsx)(l.P,{id:"roles",disabled:L,error:N,hint:le,label:ne,name:"roles",onChange:v=>{b({target:{name:"roles",value:v}})},placeholder:F,multi:!0,startIcon:de,value:X.map(v=>v.toString()),withTags:!0,required:!0,children:(w||[]).map(v=>(0,e.jsx)(i.W,{value:v.id.toString(),children:x({id:`global.${v.code}`,defaultMessage:v.name})},v.id))})};S.defaultProps={disabled:!1,error:void 0},S.propTypes={disabled:t.bool,error:t.string,onChange:t.func.isRequired,value:t.array.isRequired}},69567:(J,O,s)=>{s.d(O,{u:()=>o});var e=s(96125),t=s(29776),u=s(80107);function o(m={},l={}){const{id:i="",...P}=m,{get:D}=(0,t.useFetchClient)(),{data:n,isError:_,isLoading:g,refetch:E}=(0,u.useQuery)(["users",i,P],async()=>{const{data:{data:M}}=await D(`/admin/users/${i}`,{params:P});return M},l);return{users:e.useMemo(()=>{let M=[];return n&&("results"in n?Array.isArray(n.results)&&(M=n.results):M=[n]),M},[n]),pagination:e.useMemo(()=>(n&&"pagination"in n)??null,[n]),isLoading:g,isError:_,refetch:E}}},99216:(J,O,s)=>{s.d(O,{O:()=>D});var e=s(53657),t=s(96125),u=s(87426),o=s(2669),m=s(48814);const l=()=>(0,e.jsx)(o.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,e.jsx)(m.Z,{variant:"pi",textColor:"neutral500",children:"/"})});l.displayName="Divider";var i=s(93134);const P=(0,u.default)(i.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:n})=>`calc(-1*${n.spaces[2]})`};
  }
`,D=({label:n,children:_,...g})=>{const E=t.Children.toArray(_);return(0,e.jsx)(o.x,{"aria-label":n,...g,children:(0,e.jsx)(P,{as:"ol",children:t.Children.map(E,(d,M)=>{const K=E.length>1&&M+1<E.length;return(0,e.jsxs)(i.k,{inline:!0,as:"li",children:[d,K&&(0,e.jsx)(l,{})]})})})})};D.displayName="Breadcrumbs"},41062:(J,O,s)=>{s.d(O,{$:()=>o});var e=s(53657),t=s(2669),u=s(48814);const o=({children:m,isCurrent:l=!1,...i})=>(0,e.jsx)(t.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,e.jsx)(u.Z,{variant:"pi",textColor:"neutral800",fontWeight:l?"bold":"normal","aria-current":l,...i,children:m})});o.displayName="Crumb"}}]);

"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[1871],{1871:(w,x,s)=>{s.r(x),s.d(x,{default:()=>ds});var e=s(53657),n=s(29776),I=s(2108),B=s(67810),i=s(96125),W=s(41427),_=s(35960),r=s(48814),f=s(93134),y=s(2669),Z=s(9991),L=s(7139),P=s(55613),S=s(99283),N=s(36956),F=s(6620),$=s(87710),Y=s(16100),C=s(15227),Q=s(6289),V=s(18946),q=s(23865),ss=s(60773),es=s(63922),b=s(92639),z=s(82154),ts=s(33541),ns=s(11308),g=s(59013),os=s(78331),Ds=s(80107),cs=s(36336),Ms=s(70662),Os=s(75377),Ps=s(33099),Cs=s(25291),gs=s(70464),Rs=s(1108),ms=s(83937),us=s(3404),Ts=s(18239),hs=s(18514),Ls=s(59891),As=s(92898),vs=s(96435),xs=s(50973),Is=s(20590),Bs=s(22507),Ws=s(7453);const as=()=>"todo empty role",G=({id:o,name:d,description:a,usersCount:R,icons:l,rowIndex:A,canUpdate:E})=>{const{formatMessage:m}=(0,z.Z)(),[,u]=l,D=m({id:"Roles.RoleRow.user-count",defaultMessage:"{number, plural, =0 {#  user} one {#  user} other {# users}}"},{number:R});return(0,e.jsxs)(W.Tr,{"aria-rowindex":A,...E?(0,n.onRowClick)({fn:u.onClick}):{},children:[(0,e.jsx)(_.Td,{maxWidth:(0,n.pxToRem)(130),children:(0,e.jsx)(r.Z,{ellipsis:!0,textColor:"neutral800",children:d})}),(0,e.jsx)(_.Td,{maxWidth:(0,n.pxToRem)(250),children:(0,e.jsx)(r.Z,{ellipsis:!0,textColor:"neutral800",children:a})}),(0,e.jsx)(_.Td,{children:(0,e.jsx)(r.Z,{textColor:"neutral800",children:D})}),(0,e.jsx)(_.Td,{children:(0,e.jsx)(f.k,{justifyContent:"flex-end",...n.stopPropagation,children:l.map((c,T)=>c?(0,e.jsx)(y.x,{paddingLeft:T===0?0:1,children:(0,e.jsx)(Z.h,{onClick:c.onClick,label:c.label,noBorder:!0,icon:c.icon})},c.label):null)})})]},o)};G.propTypes={id:g.number.isRequired,name:g.string.isRequired,description:g.string.isRequired,usersCount:g.number.isRequired,icons:g.array.isRequired,rowIndex:g.number.isRequired,canUpdate:g.bool},G.defaultProps={canUpdate:!1};const ls={roleToDelete:null,showModalConfirmButtonLoading:!1,shouldRefetchData:!1},is=(o,d)=>(0,os.ZP)(o,a=>{switch(d.type){case"ON_REMOVE_ROLES":{a.showModalConfirmButtonLoading=!0;break}case"ON_REMOVE_ROLES_SUCCEEDED":{a.shouldRefetchData=!0,a.roleToDelete=null;break}case"RESET_DATA_TO_DELETE":{a.shouldRefetchData=!1,a.roleToDelete=null,a.showModalConfirmButtonLoading=!1;break}case"SET_ROLE_TO_DELETE":{a.roleToDelete=d.id;break}default:return a}}),_s=({canCreate:o,canDelete:d,canUpdate:a,refetchRoles:R})=>{const{formatMessage:l}=(0,z.Z)(),{formatAPIError:A}=(0,n.useAPIErrorHandler)(),E=(0,n.useNotification)(),[m,u]=(0,i.useState)(!1),{push:D}=(0,ts.k6)(),[{selectedRoles:c,showModalConfirmButtonLoading:T,roleToDelete:H},v]=(0,i.useReducer)(is,ls),{post:J}=(0,n.getFetchClient)(),X=async()=>{try{v({type:"ON_REMOVE_ROLES"}),await J("/admin/roles/batch-delete",{ids:[H]}),await R(),v({type:"RESET_DATA_TO_DELETE"})}catch(t){E({type:"warning",message:A(t)})}h()},U=(0,i.useCallback)(t=>{D(`/settings/roles/duplicate/${t}`)},[D]),K=()=>D("/settings/roles/new"),j=(0,i.useCallback)(t=>{v({type:"SET_ROLE_TO_DELETE",id:t}),h()},[]),h=()=>u(t=>!t),M=(0,i.useCallback)(t=>{D(`/settings/roles/${t}`)},[D]),p=(0,i.useCallback)((t,O)=>{t.preventDefault(),t.stopPropagation(),O.usersCount?E({type:"info",message:{id:"Roles.ListPage.notification.delete-not-allowed"}}):j(O.id)},[E,j]),k=(0,i.useCallback)((t,O)=>{t.preventDefault(),t.stopPropagation(),U(O.id)},[U]),Es=(0,i.useCallback)(t=>[...o?[{onClick:O=>k(O,t),label:l({id:"app.utils.duplicate",defaultMessage:"Duplicate"}),icon:(0,e.jsx)(q.Z,{})}]:[],...a?[{onClick:()=>M(t.id),label:l({id:"app.utils.edit",defaultMessage:"Edit"}),icon:(0,e.jsx)(ss.Z,{})}]:[],...d?[{onClick:O=>p(O,t),label:l({id:"global.delete",defaultMessage:"Delete"}),icon:(0,e.jsx)(es.Z,{})}]:[]],[l,p,k,M,o,a,d]);return{handleNewRoleClick:K,getIcons:Es,selectedRoles:c,isWarningDeleteAllOpened:m,showModalConfirmButtonLoading:T,handleToggleModal:h,handleDeleteData:X}},rs=()=>{const{formatMessage:o}=(0,z.Z)();(0,n.useFocusWhenNavigate)();const d=(0,I.v9)(B.s),[{query:a}]=(0,n.useQueryParams)(),{isLoading:R,allowedActions:{canCreate:l,canDelete:A,canRead:E,canUpdate:m}}=(0,n.useRBAC)(d.settings.roles),{roles:u,isLoading:D,refetch:c}=(0,ns.u)({filters:a?._q?{name:{$containsi:a._q}}:void 0},{cacheTime:0,enabled:!R&&E}),{handleNewRoleClick:T,getIcons:H,isWarningDeleteAllOpened:v,showModalConfirmButtonLoading:J,handleToggleModal:X,handleDeleteData:U}=_s({refetchRoles:c,canCreate:l,canDelete:A,canUpdate:m}),K=u.length+1,j=6;if(R)return(0,e.jsx)(L.o,{children:(0,e.jsx)(n.LoadingIndicatorPage,{})});const h=o({id:"global.roles",defaultMessage:"roles"});return(0,e.jsxs)(L.o,{children:[(0,e.jsx)(n.SettingsPageTitle,{name:"Roles"}),(0,e.jsx)(P.T,{primaryAction:l?(0,e.jsx)(S.z,{onClick:T,startIcon:(0,e.jsx)(b.Z,{}),size:"S",children:o({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,title:h,subtitle:o({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),as:"h2"}),E&&(0,e.jsx)(N.Z,{startActions:(0,e.jsx)(n.SearchURLQuery,{label:o({id:"app.component.search.label",defaultMessage:"Search for {target}"},{target:h})})}),E&&(0,e.jsxs)(F.D,{children:[(0,e.jsxs)($.i,{colCount:j,rowCount:K,footer:l?(0,e.jsx)(Y.c,{onClick:T,icon:(0,e.jsx)(b.Z,{}),children:o({id:"Settings.roles.list.button.add",defaultMessage:"Add new role"})}):null,children:[(0,e.jsx)(C.h,{children:(0,e.jsxs)(W.Tr,{"aria-rowindex":1,children:[(0,e.jsx)(_.Th,{children:(0,e.jsx)(r.Z,{variant:"sigma",textColor:"neutral600",children:o({id:"global.name",defaultMessage:"Name"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(r.Z,{variant:"sigma",textColor:"neutral600",children:o({id:"global.description",defaultMessage:"Description"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(r.Z,{variant:"sigma",textColor:"neutral600",children:o({id:"global.users",defaultMessage:"Users"})})}),(0,e.jsx)(_.Th,{children:(0,e.jsx)(Q.T,{children:o({id:"global.actions",defaultMessage:"Actions"})})})]})}),(0,e.jsx)(V.p,{children:u?.map((M,p)=>(0,e.jsx)(G,{id:M.id,name:M.name,description:M.description,usersCount:M.usersCount,icons:H(M),rowIndex:p+2,canUpdate:m},M.id))})]}),!K&&!D&&(0,e.jsx)(as,{})]}),(0,e.jsx)(n.ConfirmDialog,{isOpen:v,onConfirm:U,isConfirmButtonLoading:J,onToggleDialog:X})]})},ds=()=>{const o=(0,I.v9)(B.s);return(0,e.jsx)(n.CheckPagePermissions,{permissions:o.settings.roles.main,children:(0,e.jsx)(rs,{})})}},11308:(w,x,s)=>{s.d(x,{u:()=>i});var e=s(96125),n=s(29776),I=s(82154),B=s(80107);const i=(W={},_={})=>{const{id:r="",...f}=W,{get:y}=(0,n.useFetchClient)(),{locale:Z}=(0,I.Z)(),L=(0,n.useCollator)(Z,{sensitivity:"base"}),{data:P,error:S,isError:N,isLoading:F,refetch:$}=(0,B.useQuery)(["roles",r,f],async()=>{const{data:C}=await y(`/admin/roles/${r??""}`,{params:f});return C},_);return{roles:e.useMemo(()=>{let C=[];return P&&(Array.isArray(P.data)?C=P.data:C=[P.data]),[...C].sort((Q,V)=>L.compare(Q.name,V.name))},[P,L]),error:S,isError:N,isLoading:F,refetch:$}}}}]);

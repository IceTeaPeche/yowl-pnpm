"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[5732],{80223:(B,P,e)=>{e.d(P,{F:()=>L});var t=e(53657),n=e(96125),O=e(2669),D=e(99283),c=e(29776),E=e(33211),u=e(59013),h=e(82154);const L=({displayedFilters:_})=>{const[C,v]=(0,n.useState)(!1),{formatMessage:y}=(0,h.Z)(),R=(0,n.useRef)(),M=()=>{v(A=>!A)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(O.x,{paddingTop:1,paddingBottom:1,children:[(0,t.jsx)(D.z,{variant:"tertiary",ref:R,startIcon:(0,t.jsx)(E.Z,{}),onClick:M,size:"S",children:y({id:"app.utils.filters",defaultMessage:"Filters"})}),C&&(0,t.jsx)(c.FilterPopoverURLQuery,{displayedFilters:_,isVisible:C,onToggle:M,source:R})]}),(0,t.jsx)(c.FilterListURLQuery,{filtersSchema:_})]})};L.propTypes={displayedFilters:u.arrayOf(u.shape({name:u.string.isRequired,metadatas:u.shape({label:u.string}),fieldSchema:u.shape({type:u.string})})).isRequired}},65732:(B,P,e)=>{e.r(P),e.d(P,{default:()=>me});var t=e(53657),n=e(29776),O=e(2108),D=e(67810),c=e(93134),E=e(48814),u=e(9091),h=e(2669),L=e(50810),_=e(39450),C=e(83416),v=e(68577),y=e(17855),R=e(18946),M=e(41427),A=e(35960),Y=e(9991),J=e(8590),G=e(41777),X=e(70139),$=e(6620),k=e(7139),w=e(55613),q=e(36956),x=e(82154),ee=e(80223),b=e(80107),te=e(33541),se=e(69567),ae=e(99216),ne=e(41062),i=e(59013),ie=e(41954),re=e(65250),ue=e(96125),ge=e(36336),Ee=e(70662),ce=e(75377),pe=e(33099),De=e(25291),Me=e(70464),Pe=e(1108),Oe=e(83937),he=e(3404),Le=e(18239),ye=e(18514),fe=e(59891),Ce=e(92898),Te=e(96435),ve=e(50973),Re=e(20590),Ae=e(22507),Ue=e(7453);const oe=({canReadAuditLogs:s,canReadUsers:l})=>{const{get:g}=(0,n.useFetchClient)(),{search:r}=(0,te.TH)(),m=(0,n.useNotification)(),[{query:d}]=(0,n.useQueryParams)(),a={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:f=>m({type:"warning",message:f.message})},{users:o,isError:p,isLoading:T}=(0,se.u)({},{...a,enabled:l,staleTime:2*(1e3*60)}),{data:U,isLoading:W,isError:K}=(0,b.useQuery)(["auditLogs",r],async()=>{const{data:f}=await g("/admin/audit-logs",{params:d});return f},{...a,enabled:s});return{auditLogs:U,users:o,isLoading:T||W,hasError:K||p}},Q=()=>{const{formatDate:s}=(0,x.Z)();return g=>{const r=(0,ie.Z)(g),m=s(r,{dateStyle:"long"}),d=s(r,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${d}`}},V={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},S=s=>V[s]||s,j=({actionLabel:s,actionName:l})=>(0,t.jsxs)(c.k,{direction:"column",alignItems:"baseline",gap:1,children:[(0,t.jsx)(E.Z,{textColor:"neutral600",variant:"sigma",children:s}),(0,t.jsx)(E.Z,{textColor:"neutral600",children:l})]});j.propTypes={actionLabel:i.string.isRequired,actionName:i.string.isRequired};const F=({status:s,data:l,formattedDate:g})=>{const{formatMessage:r}=(0,x.Z)();if(s==="loading")return(0,t.jsx)(c.k,{padding:7,justifyContent:"center",alignItems:"center",children:(0,t.jsx)(u.a,{children:"Loading content..."})});const{action:m,user:d,payload:a}=l;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.x,{marginBottom:3,children:(0,t.jsx)(E.Z,{variant:"delta",id:"title",children:r({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"})})}),(0,t.jsxs)(L.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0,children:[(0,t.jsx)(j,{actionLabel:r({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:r({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:S(m)},{model:a?.model})}),(0,t.jsx)(j,{actionLabel:r({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:g}),(0,t.jsx)(j,{actionLabel:r({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:d?.displayName||"-"}),(0,t.jsx)(j,{actionLabel:r({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:d?.id.toString()||"-"})]}),(0,t.jsx)(_.V,{value:JSON.stringify(a,null,2),disabled:!0,label:r({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})})]})};F.defaultProps={data:{}},F.propTypes={status:i.oneOf(["idle","loading","error","success"]).isRequired,data:i.shape({action:i.string,date:i.string,payload:i.object,user:i.object}),formattedDate:i.string.isRequired};const z=({handleClose:s,logId:l})=>{const{get:g}=(0,n.useFetchClient)(),r=(0,n.useNotification)(),m=async T=>{const{data:U}=await g(`/admin/audit-logs/${T}`);if(!U)throw new Error("Audit log not found");return U},{data:d,status:a}=(0,b.useQuery)(["audit-log",l],()=>m(l),{onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),s()}}),o=Q(),p=d?o(d.date):"";return(0,t.jsxs)(C.P,{onClose:s,labelledBy:"title",children:[(0,t.jsx)(v.x,{children:(0,t.jsx)(ae.O,{label:p,id:"title",children:(0,t.jsx)(ne.$,{isCurrent:!0,children:p})})}),(0,t.jsx)(y.f,{children:(0,t.jsx)(F,{status:a,data:d,formattedDate:p})})]})};z.propTypes={handleClose:i.func.isRequired,logId:i.string.isRequired};const N=({pagination:s})=>(0,t.jsx)(h.x,{paddingTop:4,children:(0,t.jsxs)(c.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,t.jsx)(n.PageSizeURLQuery,{}),(0,t.jsx)(n.PaginationURLQuery,{pagination:s})]})});N.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},N.propTypes={pagination:i.shape({page:i.number,pageCount:i.number,pageSize:i.number,total:i.number})};const Z=({headers:s,rows:l,onOpenModal:g})=>{const{formatMessage:r}=(0,x.Z)(),m=Q(),d=({type:a,value:o,model:p})=>a==="date"?m(o):a==="action"?r({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:S(o)},{model:p}):o||"-";return(0,t.jsx)(R.p,{children:l.map(a=>(0,t.jsxs)(M.Tr,{...(0,n.onRowClick)({fn:()=>g(a.id)}),children:[s.map(({key:o,name:p,cellFormatter:T})=>(0,t.jsx)(A.Td,{children:(0,t.jsx)(E.Z,{textColor:"neutral800",children:d({type:o,value:T?T(a[p]):a[p],model:a.payload?.model})})},o)),(0,t.jsx)(A.Td,{...n.stopPropagation,children:(0,t.jsx)(c.k,{justifyContent:"end",children:(0,t.jsx)(Y.h,{onClick:()=>g(a.id),"aria-label":r({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${a.action} action`}),noBorder:!0,icon:(0,t.jsx)(re.Z,{})})})})]},a.id))})};Z.defaultProps={rows:[]},Z.propTypes={headers:i.array.isRequired,rows:i.array,onOpenModal:i.func.isRequired};const I=({value:s,options:l,onChange:g})=>{const{formatMessage:r}=(0,x.Z)(),m=r({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return(0,t.jsx)(J.hQ,{"aria-label":m,value:s,onChange:g,children:l.map(({label:d,customValue:a})=>(0,t.jsx)(G.O,{value:a,children:d},a))})};I.defaultProps={value:null},I.propTypes={value:i.string,options:i.arrayOf(i.shape({label:i.string.isRequired,customValue:i.string.isRequired}).isRequired).isRequired,onChange:i.func.isRequired};const H=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],de=({formatMessage:s,users:l,canReadUsers:g})=>{const r=Object.keys(V).map(d=>({label:s({id:`Settings.permissions.auditLogs.${d}`,defaultMessage:S(d)},{model:void 0}),customValue:d})),m=[{name:"action",metadatas:{customOperators:H,label:s({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),customInput:I,options:r},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:s({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(g&&l){const d=o=>o.username?o.username:o.firstname&&o.lastname?s({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:o.firstname,lastname:o.lastname}):o.email,a=l.map(o=>({label:d(o),customValue:o.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:H,label:s({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:a,customInput:I},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},le=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:s=>s?s.displayName:""}],_e=()=>{const{formatMessage:s}=(0,x.Z)(),l=(0,O.v9)(D.s),{allowedActions:{canRead:g,canReadUsers:r}}=(0,n.useRBAC)({...l.settings.auditLogs,readUsers:l.settings.users.read}),[{query:m},d]=(0,n.useQueryParams)(),{auditLogs:a,users:o,isLoading:p,hasError:T}=oe({canReadAuditLogs:g,canReadUsers:r});(0,n.useFocusWhenNavigate)();const U=de({formatMessage:s,users:o,canReadUsers:r}),W=s({id:"global.auditLogs",defaultMessage:"Audit Logs"}),K=le.map(f=>({...f,metadatas:{...f.metadatas,label:s(f.metadatas.label)}}));return T?(0,t.jsx)(X.A,{children:(0,t.jsx)($.D,{children:(0,t.jsx)(h.x,{paddingTop:8,children:(0,t.jsx)(n.AnErrorOccurred,{})})})}):(0,t.jsxs)(k.o,{"aria-busy":p,children:[(0,t.jsx)(n.SettingsPageTitle,{name:W}),(0,t.jsx)(w.T,{title:W,subtitle:s({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),(0,t.jsx)(q.Z,{startActions:(0,t.jsx)(ee.F,{displayedFilters:U})}),(0,t.jsxs)($.D,{canRead:g,children:[(0,t.jsx)(n.DynamicTable,{contentType:"Audit logs",headers:K,rows:a?.results||[],withBulkActions:!0,isLoading:p,children:(0,t.jsx)(Z,{headers:K,rows:a?.results||[],onOpenModal:f=>d({id:f})})}),(0,t.jsx)(N,{pagination:a?.pagination})]}),m?.id&&(0,t.jsx)(z,{handleClose:()=>d({id:null},"remove"),logId:m.id})]})},me=()=>{const s=(0,O.v9)(D.s);return(0,t.jsx)(n.CheckPagePermissions,{permissions:s.settings.auditLogs.main,children:(0,t.jsx)(_e,{})})}},69567:(B,P,e)=>{e.d(P,{u:()=>D});var t=e(96125),n=e(29776),O=e(80107);function D(c={},E={}){const{id:u="",...h}=c,{get:L}=(0,n.useFetchClient)(),{data:_,isError:C,isLoading:v,refetch:y}=(0,O.useQuery)(["users",u,h],async()=>{const{data:{data:M}}=await L(`/admin/users/${u}`,{params:h});return M},E);return{users:t.useMemo(()=>{let M=[];return _&&("results"in _?Array.isArray(_.results)&&(M=_.results):M=[_]),M},[_]),pagination:t.useMemo(()=>(_&&"pagination"in _)??null,[_]),isLoading:v,isError:C,refetch:y}}},99216:(B,P,e)=>{e.d(P,{O:()=>L});var t=e(53657),n=e(96125),O=e(87426),D=e(2669),c=e(48814);const E=()=>(0,t.jsx)(D.x,{"aria-hidden":!0,paddingLeft:1,paddingRight:1,children:(0,t.jsx)(c.Z,{variant:"pi",textColor:"neutral500",children:"/"})});E.displayName="Divider";var u=e(93134);const h=(0,O.default)(u.k)`
  // CrumbLinks do have padding-x, because they need to have a
  // interaction effect, which mis-aligns the breadcrumbs on the left.
  // This normalizes the behavior by moving the first item to left by
  // the same amount it has inner padding
  :first-child {
    margin-left: ${({theme:_})=>`calc(-1*${_.spaces[2]})`};
  }
`,L=({label:_,children:C,...v})=>{const y=n.Children.toArray(C);return(0,t.jsx)(D.x,{"aria-label":_,...v,children:(0,t.jsx)(h,{as:"ol",children:n.Children.map(y,(R,M)=>{const A=y.length>1&&M+1<y.length;return(0,t.jsxs)(u.k,{inline:!0,as:"li",children:[R,A&&(0,t.jsx)(E,{})]})})})})};L.displayName="Breadcrumbs"},41062:(B,P,e)=>{e.d(P,{$:()=>D});var t=e(53657),n=e(2669),O=e(48814);const D=({children:c,isCurrent:E=!1,...u})=>(0,t.jsx)(n.x,{paddingLeft:2,paddingRight:2,paddingTop:1,paddingBottom:1,children:(0,t.jsx)(O.Z,{variant:"pi",textColor:"neutral800",fontWeight:E?"bold":"normal","aria-current":E,...u,children:c})});D.displayName="Crumb"}}]);

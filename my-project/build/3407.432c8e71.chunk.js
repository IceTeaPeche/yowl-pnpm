"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[3407],{33407:(ts,c,s)=>{s.r(c),s.d(c,{CreatePage:()=>v,default:()=>Z});var t=s(53657),m=s(96125),B=s(7139),T=s(55613),r=s(93134),g=s(99283),I=s(6620),d=s(2669),h=s(48814),f=s(50810),C=s(91845),u=s(34773),U=s(84139),i=s(29776),W=s(14752),K=s(37944),x=s(18239),j=s(85392),p=s(82154),y=s(2108),R=s(33541),S=s(87426),$=s(67810),E=s(26955),P=s(59891),es=s(80107),as=s(36336),is=s(70662),ns=s(75377),os=s(33099),ds=s(25291),ls=s(70464),rs=s(1108),_s=s(83937),Es=s(3404),Ps=s(18514),Ms=s(92898),Ds=s(96435),Os=s(50973),cs=s(20590),ms=s(22507),gs=s(7453),hs=s(80922),Cs=s(12646),Rs=s(80655),vs=s(66437),Ls=s(6219),As=s(13236);const F=P.Ry().shape({name:P.Z_().required(i.translatedErrors.required),description:P.Z_().required(i.translatedErrors.required)}),N=S.default.div`
  border: 1px solid ${({theme:e})=>e.colors.primary200};
  background: ${({theme:e})=>e.colors.primary100};
  padding: ${({theme:e})=>`${e.spaces[2]} ${e.spaces[4]}`};
  color: ${({theme:e})=>e.colors.primary600};
  border-radius: ${({theme:e})=>e.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,v=()=>{const e=(0,R.$B)("/settings/roles/duplicate/:id"),L=(0,i.useNotification)(),{lockApp:z,unlockApp:V}=(0,i.useOverlayBlocker)(),{formatMessage:a}=(0,p.Z)(),[J,M]=(0,m.useState)(!1),{replace:G}=(0,R.k6)(),D=(0,m.useRef)(),{trackUsage:_}=(0,i.useTracking)(),{post:H,put:Q}=(0,i.useFetchClient)(),{params:l}=e??{},{isLoading:X,data:Y}=(0,E.u)(l?.id,{cacheTime:0}),{permissions:b,isLoading:k}=(0,E.a)({id:l?.id},{cacheTime:0,enabled:!!l?.id}),w=O=>{z(),M(!0),l?.id?_("willDuplicateRole"):_("willCreateNewRole"),Promise.resolve(H("/admin/roles",O)).then(async({data:n})=>{const{permissionsToSend:o}=D.current.getPermissions();return l?.id?_("didDuplicateRole"):_("didCreateNewRole"),n.data.id&&!j(o)&&await Q(`/admin/roles/${n.data.id}/permissions`,{permissions:o}),n}).then(n=>{M(!1),L({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),G(`/settings/roles/${n.data.id}`)}).catch(n=>{console.error(n),M(!1),L({type:"warning",message:{id:"notification.error"}})}).finally(()=>{V()})},q=`${a({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,K.Z)(new Date,"PPP")}`;return(0,t.jsxs)(B.o,{children:[(0,t.jsx)(i.SettingsPageTitle,{name:"Roles"}),(0,t.jsx)(x.J9,{initialValues:{name:"",description:q},onSubmit:w,validationSchema:F,validateOnChange:!1,children:({handleSubmit:O,values:n,errors:o,handleReset:ss,handleChange:A})=>(0,t.jsx)(i.Form,{noValidate:!0,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(T.T,{primaryAction:(0,t.jsxs)(r.k,{gap:2,children:[(0,t.jsx)(g.z,{variant:"secondary",onClick:()=>{ss(),D.current.resetForm()},size:"L",children:a({id:"app.components.Button.reset",defaultMessage:"Reset"})}),(0,t.jsx)(g.z,{onClick:O,loading:J,size:"L",children:a({id:"global.save",defaultMessage:"Save"})})]}),title:a({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:a({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:(0,t.jsx)(i.Link,{startIcon:(0,t.jsx)(W.Z,{}),to:"/settings/roles",children:a({id:"global.back",defaultMessage:"Back"})})}),(0,t.jsx)(I.D,{children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:6,children:[(0,t.jsx)(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsxs)(r.k,{direction:"column",alignItems:"stretch",gap:4,children:[(0,t.jsxs)(r.k,{justifyContent:"space-between",children:[(0,t.jsxs)(d.x,{children:[(0,t.jsx)(d.x,{children:(0,t.jsx)(h.Z,{fontWeight:"bold",children:a({id:"global.details",defaultMessage:"Details"})})}),(0,t.jsx)(d.x,{children:(0,t.jsx)(h.Z,{variant:"pi",textColor:"neutral600",children:a({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})})})]}),(0,t.jsx)(N,{children:a({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0})})]}),(0,t.jsxs)(f.r,{gap:4,children:[(0,t.jsx)(C.P,{col:6,children:(0,t.jsx)(u.o,{name:"name",error:o.name&&a({id:o.name}),label:a({id:"global.name",defaultMessage:"Name"}),onChange:A,required:!0,value:n.name})}),(0,t.jsx)(C.P,{col:6,children:(0,t.jsx)(U.g,{label:a({id:"global.description",defaultMessage:"Description"}),id:"description",error:o.description&&a({id:o.description}),onChange:A,children:n.description})})]})]})}),!X&&!k?(0,t.jsx)(d.x,{shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(E.P,{isFormDisabled:!1,ref:D,permissions:b,layout:Y})}):(0,t.jsx)(d.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0,children:(0,t.jsx)(i.LoadingIndicatorPage,{})})]})})]})})})]})};function Z(){const e=(0,y.v9)($.s);return(0,t.jsx)(i.CheckPagePermissions,{permissions:e.settings.roles.create,children:(0,t.jsx)(v,{})})}}}]);

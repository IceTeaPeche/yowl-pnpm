"use strict";(self.webpackChunkmy_project=self.webpackChunkmy_project||[]).push([[2420],{92420:(Es,Y,t)=>{t.r(Y),t.d(Y,{default:()=>ss});var e=t(53657),p=t(96125),R=t(2669),w=t(91019),A=t(93134),y=t(99283),q=t(83416),ee=t(17855),Pe=t(9091),Ce=t(68577),I=t(48814),ve=t(50810),se=t(91845),je=t(61519),Oe=t(77461),ye=t(55613),Ae=t(51089),Le=t(70139),te=t(7139),Te=t(36956),K=t(9991),Re=t(6620),Ie=t(6289),Be=t(58218),c=t(29776),Ue=t(3404),v=t(82154),L=t(33541),We=t(58641),s=t(35575),hs=t(8596),ae=t(50973),Fe=t(63922),Se=t(38541),Ke=t(23702),b=t(92639),be=t(33211),Ze=t(14752),ze=t(53169),Qe=t(44193),$e=t(2576),Ve=t(60773),Z=t(87426),u=t(59013),Ne=t(18239),Ge=t(85392),ne=t(80107),ps=t(23787),ms=t(59891),Ms=t(56771),Ds=t(88360);const ke=(a,{pathname:o,query:r})=>{let l=[{id:null,label:{id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"},href:a?(0,s.a)(o,r):void 0}];return a?.parent?.parent&&l.push([]),a?.parent&&l.push({id:a.parent.id,label:a.parent.name,href:(0,s.a)(o,r,{folder:a.parent.id,folderPath:a.parent.path})}),a&&l.push({id:a.id,label:a.name}),l},He=a=>{const{id:o}=(0,s.u)();return(0,e.jsx)(R.x,{position:"relative",zIndex:2,children:(0,e.jsx)(w.C,{"aria-labelledby":`${o}-title`,...a})})},z=({pagination:a})=>(0,e.jsx)(R.x,{paddingTop:6,children:(0,e.jsxs)(A.k,{alignItems:"flex-end",justifyContent:"space-between",children:[(0,e.jsx)(c.PageSizeURLQuery,{}),(0,e.jsx)(c.PaginationURLQuery,{pagination:a})]})});z.defaultProps={pagination:{pageCount:0,pageSize:10,total:0}},z.propTypes={pagination:u.shape({page:u.number,pageCount:u.number,pageSize:u.number,total:u.number})};const oe=({selected:a,onSuccess:o})=>{const{formatMessage:r}=(0,v.Z)(),[l,d]=(0,p.useState)(!1),{isLoading:g,remove:_}=(0,s.b)(),E=async()=>{await _(a),o()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.z,{variant:"danger-light",size:"S",startIcon:(0,e.jsx)(Fe.Z,{}),onClick:()=>d(!0),children:r({id:"global.delete",defaultMessage:"Delete"})}),(0,e.jsx)(c.ConfirmDialog,{isConfirmButtonLoading:g,isOpen:l,onToggleDialog:()=>d(!1),onConfirm:E})]})};oe.propTypes={selected:u.arrayOf(s.A,s.F).isRequired,onSuccess:u.func.isRequired};const Je=()=>{const a=(0,c.useNotification)(),o=(0,ne.useQueryClient)(),{post:r}=(0,c.useFetchClient)(),l=({destinationFolderId:_,filesAndFolders:E})=>{const f=E.reduce((h,x)=>{const{id:i,type:j}=x,m=j==="asset"?"fileIds":"folderIds";return h[m]||(h[m]=[]),h[m].push(i),h},{});return r("/upload/actions/bulk-move",{...f,destinationFolderId:_})},d=(0,ne.useMutation)(l,{onSuccess(_){const{data:{data:E}}=_;E?.files?.length>0&&(o.refetchQueries([s.p,"assets"],{active:!0}),o.refetchQueries([s.p,"asset-count"],{active:!0})),o.refetchQueries([s.p,"folders"],{active:!0}),a({type:"success",message:{id:(0,s.g)("modal.move.success-label"),defaultMessage:"Elements have been moved successfully."}})}});return{...d,move:(_,E)=>d.mutateAsync({destinationFolderId:_,filesAndFolders:E})}},Q=({onClose:a,selected:o,currentFolder:r})=>{const{formatMessage:l}=(0,v.Z)(),{data:d,isLoading:g}=(0,s.c)(),{move:_}=Je();if(!d)return null;const E=async(x,{setErrors:i})=>{try{await _(x.destination.value,o),a()}catch(j){const B=(0,c.normalizeAPIError)(j).errors.reduce((U,P)=>(U[P.values?.path?.length||"destination"]=P.defaultMessage,U),{});Ge(B)||i(B)}},f=()=>{a()};if(g)return(0,e.jsx)(q.P,{onClose:f,labelledBy:"title",children:(0,e.jsx)(ee.f,{children:(0,e.jsx)(A.k,{justifyContent:"center",paddingTop:4,paddingBottom:4,children:(0,e.jsx)(Pe.a,{children:l({id:(0,s.g)("content.isLoading"),defaultMessage:"Content is loading."})})})})});const h={destination:{value:r?.id||"",label:r?.name||d[0].label}};return(0,e.jsx)(q.P,{onClose:f,labelledBy:"title",children:(0,e.jsx)(Ne.J9,{validateOnChange:!1,onSubmit:E,initialValues:h,children:({values:x,errors:i,setFieldValue:j})=>(0,e.jsxs)(c.Form,{noValidate:!0,children:[(0,e.jsx)(Ce.x,{children:(0,e.jsx)(I.Z,{fontWeight:"bold",textColor:"neutral800",as:"h2",id:"title",children:l({id:(0,s.g)("modal.folder.move.title"),defaultMessage:"Move elements to"})})}),(0,e.jsx)(ee.f,{children:(0,e.jsx)(ve.r,{gap:4,children:(0,e.jsx)(se.P,{xs:12,col:12,children:(0,e.jsxs)(A.k,{direction:"column",alignItems:"stretch",gap:1,children:[(0,e.jsx)(je.Q,{htmlFor:"folder-destination",children:l({id:(0,s.g)("form.input.label.folder-location"),defaultMessage:"Location"})}),(0,e.jsx)(s.S,{options:d,onChange:m=>{j("destination",m)},defaultValue:x.destination,name:"destination",menuPortalTarget:document.querySelector("body"),inputId:"folder-destination",error:i?.destination,ariaErrorMessage:"destination-error"}),i.destination&&(0,e.jsx)(I.Z,{variant:"pi",as:"p",id:"folder-destination-error",textColor:"danger600",children:i.destination})]})})})}),(0,e.jsx)(Oe.m,{startActions:(0,e.jsx)(y.z,{onClick:f,variant:"tertiary",name:"cancel",children:l({id:"cancel",defaultMessage:"Cancel"})}),endActions:(0,e.jsx)(y.z,{type:"submit",loading:g,children:l({id:"modal.folder.move.submit",defaultMessage:"Move"})})})]})})})};Q.defaultProps={currentFolder:void 0},Q.propTypes={onClose:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.F,s.A).isRequired};const $=({selected:a,onSuccess:o,currentFolder:r})=>{const{formatMessage:l}=(0,v.Z)(),[d,g]=(0,p.useState)(!1),_=()=>{g(!1),o()};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.z,{variant:"secondary",size:"S",startIcon:(0,e.jsx)(Se.Z,{}),onClick:()=>g(!0),children:l({id:"global.move",defaultMessage:"Move"})}),d&&(0,e.jsx)(Q,{currentFolder:r,onClose:_,selected:a})]})};$.defaultProps={currentFolder:void 0},$.propTypes={onSuccess:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.A,s.F).isRequired};const V=({selected:a,onSuccess:o,currentFolder:r})=>{const{formatMessage:l}=(0,v.Z)();return(0,e.jsxs)(A.k,{gap:2,paddingBottom:5,children:[(0,e.jsx)(I.Z,{variant:"epsilon",textColor:"neutral600",children:l({id:(0,s.g)("list.assets.selected"),defaultMessage:"{numberFolders, plural, one {1 folder} other {# folders}} - {numberAssets, plural, one {1 asset} other {# assets}} selected"},{numberFolders:a.filter(({type:d})=>d==="folder").length,numberAssets:a.filter(({type:d})=>d==="asset").length})}),(0,e.jsx)(oe,{selected:a,onSuccess:o}),(0,e.jsx)($,{currentFolder:r,selected:a,onSuccess:o})]})};V.defaultProps={currentFolder:void 0},V.propTypes={onSuccess:u.func.isRequired,currentFolder:s.F,selected:u.arrayOf(s.A,s.F).isRequired};const Xe=({isFiltering:a,canCreate:o,canRead:r})=>a?{id:"list.assets-empty.title-withSearch",defaultMessage:"There are no elements with the applied filters"}:r?o?{id:"list.assets.empty-upload",defaultMessage:"Upload your first assets..."}:{id:"list.assets.empty",defaultMessage:"Media Library is empty"}:{id:"header.actions.no-permissions",defaultMessage:"No permissions to view"},ie=({canCreate:a,isFiltering:o,canRead:r,onActionClick:l})=>{const{formatMessage:d}=(0,v.Z)(),g=Xe({isFiltering:o,canCreate:a,canRead:r});return(0,e.jsx)(s.E,{icon:r?null:Ke.Z,action:a&&!o&&(0,e.jsx)(y.z,{variant:"secondary",startIcon:(0,e.jsx)(b.Z,{}),onClick:l,children:d({id:(0,s.g)("header.actions.add-assets"),defaultMessage:"Add new assets"})}),content:d({...g,id:(0,s.g)(g.id)})})};ie.propTypes={canCreate:u.bool.isRequired,canRead:u.bool.isRequired,isFiltering:u.bool.isRequired,onActionClick:u.func.isRequired};const Ye=()=>{const a=(0,p.useRef)(null),[o,r]=(0,p.useState)(!1),{formatMessage:l}=(0,v.Z)(),{trackUsage:d}=(0,c.useTracking)(),[{query:g},_]=(0,c.useQueryParams)(),E=g?.filters?.$and||[],f=()=>r(i=>!i),h=i=>{_({filters:{$and:i},page:1})},x=i=>{d("didFilterMediaLibraryElements",{location:"content-manager",filter:Object.keys(i[i.length-1])[0]}),_({filters:{$and:i},page:1})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(y.z,{variant:"tertiary",ref:a,startIcon:(0,e.jsx)(be.Z,{}),onClick:f,size:"S",children:l({id:"app.utils.filters",defaultMessage:"Filters"})}),o&&(0,e.jsx)(s.d,{displayedFilters:s.e,filters:E,onSubmit:x,onToggle:f,source:a}),(0,e.jsx)(s.f,{appliedFilters:E,filtersSchema:s.e,onRemoveFilter:h})]})},N=({breadcrumbs:a,canCreate:o,folder:r,onToggleEditFolderDialog:l,onToggleUploadAssetDialog:d})=>{const{formatMessage:g}=(0,v.Z)(),{pathname:_}=(0,L.TH)(),[{query:E}]=(0,c.useQueryParams)(),f={...E,folder:r?.parent?.id??void 0,folderPath:r?.parent?.path??void 0};return(0,e.jsx)(ye.T,{title:g({id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"}),subtitle:a&&r&&(0,e.jsx)(s.h,{as:"nav",label:g({id:(0,s.g)("header.breadcrumbs.nav.label"),defaultMessage:"Folders navigation"}),breadcrumbs:a,currentFolderId:r?.id}),navigationAction:r&&(0,e.jsx)(Ae.r,{startIcon:(0,e.jsx)(Ze.Z,{}),to:`${_}?${(0,ae.stringify)(f,{encode:!1})}`,children:g({id:(0,s.g)("header.actions.folder-level-up"),defaultMessage:"Back"})}),primaryAction:o&&(0,e.jsxs)(A.k,{gap:2,children:[(0,e.jsx)(y.z,{startIcon:(0,e.jsx)(b.Z,{}),variant:"secondary",onClick:l,children:g({id:(0,s.g)("header.actions.add-folder"),defaultMessage:"Add new folder"})}),(0,e.jsx)(y.z,{startIcon:(0,e.jsx)(b.Z,{}),onClick:d,children:g({id:(0,s.g)("header.actions.add-assets"),defaultMessage:"Add new assets"})})]})})};N.defaultProps={breadcrumbs:!1,folder:null},N.propTypes={breadcrumbs:u.oneOfType([s.B,u.bool]),canCreate:u.bool.isRequired,folder:s.F,onToggleEditFolderDialog:u.func.isRequired,onToggleUploadAssetDialog:u.func.isRequired};const we=(0,Z.default)(R.x)`
  height: ${32/16}rem;
  display: flex;
  align-items: center;
`,re=(0,Z.default)(I.Z)`
  max-width: 100%;
`,le=(0,Z.default)(R.x)`
  svg {
    path {
      fill: ${({theme:a})=>a.colors.neutral500};
    }
  }
`,qe=()=>{const{push:a}=(0,L.k6)(),{canRead:o,canCreate:r,canUpdate:l,canCopyLink:d,canDownload:g,isLoading:_}=(0,s.i)(),E=(0,p.useRef)(),{formatMessage:f}=(0,v.Z)(),{pathname:h}=(0,L.TH)(),{trackUsage:x}=(0,c.useTracking)(),[{query:i},j]=(0,c.useQueryParams)(),m=Boolean(i._q||i.filters),[B,U]=(0,c.usePersistentState)(s.l.view,s.v.GRID),P=B===s.v.GRID,{data:C,isLoading:ts,errors:as}=(0,s.j)({skipWhen:!o,query:i}),{data:ns,isLoading:os,errors:is}=(0,s.k)({enabled:o&&C?.pagination?.page===1&&!(0,s.m)(i),query:i}),{data:G,isLoading:de,error:rs}=(0,s.n)(i?.folder,{enabled:o&&!!i?.folder});rs?.response?.status===404&&a(h);const W=ns?.map(n=>({...n,type:"folder",folderURL:(0,s.a)(h,i,n.id),isSelectable:l}))??[],M=W?.length||0,F=C?.results?.map(n=>({...n,type:"asset",isSelectable:l}))||[],D=F?.length??0,ls=C?.pagination?.total,ce=de||os||_||ts,[ds,cs]=(0,p.useState)(!1),[gs,ge]=(0,p.useState)(!1),[ue,k]=(0,p.useState)(void 0),[H,_e]=(0,p.useState)(void 0),[O,{selectOne:S,selectAll:fe}]=(0,c.useSelectionState)(["type","id"],[]),Ee=O?.length>0&&O?.length!==D+M,J=()=>cs(n=>!n),he=({created:n=!1}={})=>{n&&i?.page!=="1"&&j({...i,page:1}),ge(T=>!T)},pe=(n,T)=>{n.target.checked&&x("didSelectAllMediaLibraryElements"),fe(T)},me=n=>{x("didSortMediaLibraryElements",{location:"upload",sort:n}),j({sort:n})},Me=n=>{_e(n),ge(!0)},us=n=>{_e(null),he(n),E.current&&E.current.focus()},De=n=>{n===D&&C.pagination.page===C.pagination.pageCount&&C.pagination.page>1&&j({...i,page:C.pagination.page-1})},_s=()=>{fe(),De(O.length)};return(0,c.useFocusWhenNavigate)(),(0,e.jsxs)(Le.A,{children:[(0,e.jsxs)(te.o,{"aria-busy":ce,children:[(0,e.jsx)(N,{breadcrumbs:!de&&ke(G,{pathname:h,query:i}),canCreate:r,onToggleEditFolderDialog:he,onToggleUploadAssetDialog:J,folder:G}),(0,e.jsx)(Te.Z,{startActions:(0,e.jsxs)(e.Fragment,{children:[l&&P&&(D>0||M>0)&&(0,e.jsx)(we,{paddingLeft:2,paddingRight:2,background:"neutral0",hasRadius:!0,borderColor:"neutral200",children:(0,e.jsx)(w.C,{"aria-label":f({id:(0,s.g)("bulk.select.label"),defaultMessage:"Select all folders & assets"}),indeterminate:Ee,value:(D>0||M>0)&&O.length===D+M,onChange:n=>pe(n,[...F,...W])})}),o&&P&&(0,e.jsx)(s.o,{value:i?.sort,onChangeSort:me}),o&&(0,e.jsx)(Ye,{})]}),endActions:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(c.CheckPermissions,{permissions:s.P.configureView,children:(0,e.jsx)(le,{paddingTop:1,paddingBottom:1,children:(0,e.jsx)(K.h,{forwardedAs:We.rU,to:{pathname:`${h}/configuration`,search:(0,ae.stringify)(i,{encode:!1})},icon:(0,e.jsx)(ze.Z,{}),label:f({id:"app.links.configure-view",defaultMessage:"Configure the view"})})})}),(0,e.jsx)(le,{paddingTop:1,paddingBottom:1,children:(0,e.jsx)(K.h,{icon:P?(0,e.jsx)(Qe.Z,{}):(0,e.jsx)($e.Z,{}),label:f(P?{id:(0,s.g)("view-switch.list"),defaultMessage:"List View"}:{id:(0,s.g)("view-switch.grid"),defaultMessage:"Grid View"}),onClick:()=>U(P?s.v.LIST:s.v.GRID)})}),(0,e.jsx)(c.SearchURLQuery,{label:f({id:(0,s.g)("search.label"),defaultMessage:"Search for an asset"}),trackedEvent:"didSearchMediaLibraryElements",trackedEventDetails:{location:"upload"}})]})}),(0,e.jsxs)(Re.D,{children:[O.length>0&&(0,e.jsx)(V,{currentFolder:G,selected:O,onSuccess:_s}),ce&&(0,e.jsx)(c.LoadingIndicatorPage,{}),(as||is)&&(0,e.jsx)(c.AnErrorOccurred,{}),M===0&&D===0&&(0,e.jsx)(ie,{canCreate:r,canRead:o,isFiltering:m,onActionClick:J}),o&&!P&&(D>0||M>0)&&(0,e.jsx)(s.T,{assetCount:D,folderCount:M,indeterminate:Ee,onChangeSort:me,onChangeFolder:(n,T)=>a((0,s.a)(h,i,{folder:n,folderPath:T})),onEditAsset:k,onEditFolder:Me,onSelectOne:S,onSelectAll:pe,rows:[...W,...F],selected:O,shouldDisableBulkSelect:!l,sortQuery:i?.sort??""}),o&&P&&(0,e.jsxs)(e.Fragment,{children:[M>0&&(0,e.jsx)(s.q,{title:(m&&D>0||!m)&&f({id:(0,s.g)("list.folders.title"),defaultMessage:"Folders ({count})"},{count:M})||"",children:W.map(n=>{const fs=!!O.filter(({type:X})=>X==="folder").find(X=>X.id===n.id),xe=(0,s.a)(h,i,{folder:n?.id,folderPath:n?.path});return(0,e.jsx)(se.P,{col:3,children:(0,e.jsx)(s.r,{ref:H&&n.id===H.id?E:void 0,ariaLabel:n.name,id:`folder-${n.id}`,to:xe,startAction:S&&n.isSelectable?(0,e.jsx)(He,{"data-testid":`folder-checkbox-${n.id}`,value:fs,onChange:()=>S(n)}):null,cardActions:(0,e.jsx)(K.h,{icon:(0,e.jsx)(Ve.Z,{}),"aria-label":f({id:(0,s.g)("list.folder.edit"),defaultMessage:"Edit folder"}),onClick:()=>Me(n)}),children:(0,e.jsx)(s.s,{children:(0,e.jsx)(s.t,{to:xe,children:(0,e.jsxs)(A.k,{as:"h2",direction:"column",alignItems:"start",maxWidth:"100%",children:[(0,e.jsxs)(re,{fontWeight:"semiBold",ellipsis:!0,children:[n.name,(0,e.jsx)(Ie.T,{children:":"})]}),(0,e.jsx)(re,{as:"span",textColor:"neutral600",variant:"pi",ellipsis:!0,children:f({id:(0,s.g)("list.folder.subtitle"),defaultMessage:"{folderCount, plural, =0 {# folder} one {# folder} other {# folders}}, {filesCount, plural, =0 {# asset} one {# asset} other {# assets}}"},{folderCount:n.children.count,filesCount:n.files.count})})]})})})})},`folder-${n.id}`)})}),D>0&&M>0&&(0,e.jsx)(R.x,{paddingTop:6,paddingBottom:4,children:(0,e.jsx)(Be.i,{})}),D>0&&(0,e.jsx)(s.w,{assets:F,onEditAsset:k,onSelectAsset:S,selectedAssets:O.filter(({type:n})=>n==="asset"),title:(!m||m&&M>0)&&C?.pagination?.page===1&&f({id:(0,s.g)("list.assets.title"),defaultMessage:"Assets ({count})"},{count:ls})||""})]}),C?.pagination&&(0,e.jsx)(z,{pagination:C.pagination})]})]}),ds&&(0,e.jsx)(s.U,{onClose:J,trackedLocation:"upload",folderId:i?.folder}),gs&&(0,e.jsx)(s.x,{onClose:us,folder:H,parentFolderId:i?.folder,location:"upload"}),ue&&(0,e.jsx)(s.y,{onClose:n=>{n===null&&De(1),k(void 0)},asset:ue,canUpdate:l,canCopyLink:d,canDownload:g,trackedLocation:"upload"})]})},es=(0,p.lazy)(()=>t.e(5889).then(t.bind(t,65889))),ss=()=>{const{config:{isLoading:a,isError:o,data:r}}=(0,s.z)(),[{rawQuery:l},d]=(0,c.useQueryParams)(),{formatMessage:g}=(0,v.Z)(),_=g({id:(0,s.g)("plugin.name"),defaultMessage:"Media Library"});return(0,p.useEffect)(()=>{a||o||l||d({sort:r.sort,page:1,pageSize:r.pageSize})},[a,o,r,l,d]),(0,c.useFocusWhenNavigate)(),(0,e.jsxs)(te.o,{"aria-busy":a,children:[(0,e.jsx)(Ue.q,{title:_}),a&&(0,e.jsx)(c.LoadingIndicatorPage,{}),l?(0,e.jsx)(p.Suspense,{fallback:(0,e.jsx)(c.LoadingIndicatorPage,{}),children:(0,e.jsxs)(L.rs,{children:[(0,e.jsx)(L.AW,{exact:!0,path:`/plugins/${s.p}`,component:qe}),(0,e.jsx)(L.AW,{exact:!0,path:`/plugins/${s.p}/configuration`,render:()=>(0,e.jsx)(es,{config:r})})]})}):null]})}}}]);
